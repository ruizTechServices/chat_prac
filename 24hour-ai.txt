# 24Hourâ€‘AI â€” Comprehensive Product & Technical Specification

**Version:** 0.9 (AprilÂ 27Â 2025)  
**Owner:** Gio (LuisÂ GiovanniÂ Ruiz)  
**Status:** Draft (living document â€” iterate until all checklist items are âœ…)  
**Previous Name:** 24HourGPT  

---
## 1Â Â· Executive Summary
24Hourâ€‘AI is a paid AIâ€‘asâ€‘aâ€‘Service chat platform that sells **timeâ€‘boxed chat passes** (24â€¯h) and **recurring subscriptions**. Users choose cuttingâ€‘edge LLMs (GPTâ€‘4o, Mistralâ€‘Large, GeminiÂ 1.5) and interact through a polished web app. The business model couples lowâ€‘friction pricing (\$1 pass, \$5 reasoning pass) with a \$50â€¯/â€¯mo Pro tier that unlocks persistent history and higher token budgets. All prior conversations have converged on a **Next.jsÂ 15 + TS + Supabase + Pinecone + Clerk + Square + ShadCNÂ UI** stack, with modular â€œnodesâ€ (PocketFlowâ€‘style) so new capabilities slot in without rewrites.

---
## 2Â Â· Goals & Nonâ€‘Goals
| # | Goal | Nonâ€‘Goal |
|---|------|----------|
| 1 | Deliver a **MVP** that reliably sells 24â€¯h chat access | Native mobile apps (defer) |
| 2 | Keep infra **stateless** for pass users; offer persistence only for subscribers | Longâ€‘term free storage |
| 3 | Support **multiple LLM providers** via a pluggable class system | Hosting our own GPU inference at launch |
| 4 | Treat payments & auth as firstâ€‘class flows (Square + Clerk) | Stripe (for this product), PayPal |
| 5 | Expose admin analytics & manual refund tools | Fancy BI suite |
| 6 | Ship with ShadCNâ€‘styled UI that feels premium | Pixelâ€‘perfect bespoke branding at MVP |

---
## 3Â Â· Personas & Use Cases
1. **Occasional User** â€” pays \$1, asks <Â 50 messages, wants quick answer, no storage.
2. **Power User** â€” buys \$5 â€œReasoning Passâ€ for heavier tokens, still no storage.
3. **SMB Owner** â€” \$50/mo subscription; expects persistent chat, JSONL export, and priority models.
4. **Gio / Admin** â€” monitors metrics, sets prices, handles refunds & abuse.

---
## 4Â Â· System Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  HTTPS   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Edge Fn   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReactÂ App   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Next.js API Routesâ”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ LLM Adaptersâ”‚
â”‚  (App Router)â”‚          â”‚  (Server Actions) â”‚             â”‚(OpenAI â€¦)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Session / Clerk JWT       â”‚ Supabase RPC                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚   Clerk      â”‚           â”‚  Supabase      â”‚  Webhooks      â”‚ Pinecone  â”‚
â”‚ (Auth)       â”‚           â”‚  (Postgres +   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Vector   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  Storage)      â”‚                â”‚  DB       â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
* **Frontend:** Next.jsÂ 14 (App Router, Server Components). ShadCN UI, Reactâ€‘Query for data fetching.  
* **Backend:** Next.js API routes + Edge Functions for streaming responses.  
* **Database:** SupabaseÂ (Postgres) with Rowâ€‘Level Security. Tables: `users`, `passes`, `subscriptions`, `chat_sessions`, `messages`, `payments`.  
* **Vectors:** Pinecone index keyed by `session_id` (pass users) or `user_id` (subscribers).  
* **Auth:** Clerk JWT; webhook grants or revokes Supabase RLS roles.  
* **Payments:** Square Checkout Links â†’ Webhook â†’ `payments` table; passes unlocked via signed cookie.  
* **Caching:** RedisÂ Cloud for recent answer caching & rateâ€‘limit buckets (future).  
* **CI/CD:** GitHubÂ Actions â†’ Vercel.  

---
## 5Â Â· Techâ€‘Stack Rationale (latest decisions)
| Layer | Choice | Conversation Reference |
|-------|--------|------------------------|
| Frontend | Next.js 14 + TS + ShadCN | 04â€‘21, 04â€‘26 modular components |
| Auth | Clerk | 03â€‘30, 04â€‘21 discussions |
| DB | Supabase (PostgresÂ +Â Storage) | Multiple chats since 2024â€‘07 |
| Vectors | Pinecone | 03â€‘11 RAG plan |
| Cache | Redis Cloud | 10â€‘07 decision |
| Payment | Square APIs | 02â€‘07 & 01â€‘24 notes |
| LLM | OpenAI, Mistral, Google via pluggable adapters | 04â€‘06 modular LLM classes |
| Orchestration | PocketFlowâ€‘style Nodes | 04â€‘27 â€œBaseNodeâ€ dialogue |

---
## 6Â Â· Feature Map
### 6.1Â Chat Experience
1. **Message Stream w/ Tokens Counter** (ShadCN `ScrollArea`).
2. **Model Selector** (dropdown) â€” GPTâ€‘4o default, others behind checks.
3. **Chat Pass Timer** â€” countdown badge; disables input when expired.
4. **History Download** (JSONL export) for pass users.
5. **Persistent History** view for subscribers (`/dashboard/history`).

### 6.2Â Commerce
* **Pass Purchase Flow**  
  1. User not signed in â†’ Clerk signâ€‘up.  
  2. Square Checkout â†’ webhook writes `passes` row `{expires_at}`.  
  3. Signed cookie `pass_token` sent to browser.
* **Subscription Flow** â€” Square recurring plans; webhook toggles `subscriptions.active`.
* **Admin Refund UI** â€” call Square Refund API.

### 6.3Â Account & Admin
* **Settings** page â€” API key visibility, theme.
* **Admin Dashboard** â€” metrics (new passes, GMV, top models), toggle maintenance.
* **RLS Roles** â€” `anon`, `pass`, `subscriber`, `admin`.

---
## 7Â Â· Data Model (Supabase)
```mermaid
erDiagram
  users ||--o{ chat_sessions : "has"
  users ||--o{ passes : "purchases"
  users ||--o{ subscriptions : "subscribes"
  passes ||--o{ chat_sessions : "unlocks"
  chat_sessions ||--|{ messages : "contains"
  users ||--o{ payments : "records"
```
Key columns (nonâ€‘exhaustive):
* **users**: `id`, `clerk_id`, `email`, `role`
* **passes**: `id`, `user_id`, `type`, `expires_at`
* **subscriptions**: `id`, `user_id`, `status`, `plan`, `renew_at`
* **chat_sessions**: `id`, `user_id`, `model`, `started_at`
* **messages**: `id`, `session_id`, `role`, `content`, `vector_id`
* **payments**: `id`, `user_id`, `square_payment_id`, `amount`, `status`

---
## 8Â Â· Pluggable LLM Class System (pseudocode)
```ts
interface LLMModule {
  name: string;
  maxTokens: number;
  embed(text: string): Promise<Float32Array>;
  chat(messages: Message[], opts: ChatOpts): AsyncIterable<Delta>;
}
```
Adapters: `OpenAIChat`, `MistralChat`, `GeminiChat`.  
Frontâ€‘end dropdown drives `providerKey` â†’ server picks class.

---
## 9Â Â· PocketFlowâ€‘Inspired Node Graph
```python
class AuthNode(BaseNode):
    def exec(self, prep):
        assert prep["role"] in {"pass","subscriber"}, "Unauthorized"

class PaymentCheckNode(BaseNode):
    def exec(self, prep):
        if prep["pass_expired"]: raise ExpiredError

class ChatNode(BaseNode):
    def exec(self, prep):
        return llm.chat(prep["history"], opts)

AuthNode().next(PaymentCheckNode()).next(ChatNode())
```
Future nodes: `EmbedNode`, `StoreVectorNode`, `ModerationNode`.

---
## 10Â Â· API Contracts
| Method | Route | Auth | Body | Notes |
|--------|-------|------|------|-------|
| POST | `/api/chat` | Clerk JWT | `{sessionId?, messages[], model}` | Streams textÂ +Â usage |
| POST | `/api/passes/webhook` | Square | raw | Verifies signature, inserts pass |
| POST | `/api/subscriptions/webhook` | Square | raw | Upsert subscription |
| GET | `/api/history/:sessionId` | passÂ orÂ subscriber | â€“ | Returns paginated messages |

---
## 11Â Â· Security & Compliance
* **RLSÂ everywhere** â€” default deny.  
* **Supabase Policies**: row owner OR admin.  
* **Signed URLs** for pass timer cookie.  
* **LLM Moderation** â†’ OpenAI moderation API before reply.  
* GDPR: user can delete all data (`/settings/delete`).

---
## 12Â Â· Deployment & Ops
* **Vercel** â†’ Preview + Prod.
* **Supabase Cloud** â€” free tier dev, paid prod.
* **Pinecone Starterâ€‘p2** index.
* **GitHubÂ Actions** â€” lint, typeâ€‘check, e2e Playwright, autoâ€‘deploy.
* **Monitoring** â€” Vercel Analytics, Supabase Logs, Sentry.

---
## 13Â Â· Checklist Tracker
| Area | Task | Status |
|------|------|--------|
| Domain | `24hour-ai.com` purchased | âœ…Â Done |
| Repo | Next.js scaffold w/ TS | âœ…Â Done |
| Auth | Integrate Clerk provider | â¬œ Inâ€‘progress |
| Payments | Square checkout & webhooks | â¬œ |
| DB | Supabase schema & RLS | â¬œ |
| Vectors | Pinecone index + upsert | â¬œ |
| Chat | `/api/chat` streaming route | âœ… |
| Nodes | Refactor into PocketFlow nodes | â¬œ |
| UI | ShadCN component library installed | âœ… |
| Design | Luxury theme polish | â¬œ |
| Admin | Metrics dashboard | â¬œ |
| CI/CD | GitHub Actions â†’ Vercel | âœ… |

**Loop until table is all âœ….** Each sprint begins by scanning this list, checking items, and implementing the next highestâ€‘value empty cell.

---
## 14Â Â· Roadmap (6â€‘Week MVP Push)
| Week | Focus | Outcomes |
|------|-------|----------|
| 1 | Clerk auth, Supabase schema | Users table w/ RLS, signâ€‘in flows |
| 2 | Square pass purchase | Checkout link, webhook pass unlock |
| 3 | Subscription tier | Recurring plan, role upgrade |
| 4 | Vector storage | Upsert on message save, retrieval on prompt |
| 5 | Admin & analytics | Dashboard, refund flow |
| 6 | Design polish, QA | Responsive, accessibility, launch ğŸš€ |

---
## 15Â Â· Industry Tips & Reminders
* **Rateâ€‘limit** `/api/chat` per IP & ClerkÂ ID (Redis sliding window).  
* **Edge Functions** give lower latency for streaming completions.  
* **Avoid env leakage** â€” assume keys already exist (per Gioâ€™s rule).  
* **Square** needs an **`Origin` whitelist** for Checkout success redirect.  
* **Test webhooks locally** with **ngrok + `npmÂ runÂ squared`** script.

---
## 16Â Â· Open Questions
1. Final decide between **ReactÂ Query** vs **SWR** (pick one).  
2. Will we offer **Claude** via Anthropic at launch? (pricing TBD).  
3. Export formats besides JSONL (PDF transcript?).

---
**Next Step â†’** Gio, scan the checklist. Confirm priorities or tweak the 6â€‘week roadmap, then weâ€™ll break WeekÂ 1 tasks into issues.

